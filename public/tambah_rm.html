<!DOCTYPE html>
<html lang="en" class="bg-gray-50">
<head>
  <meta charset="UTF-8">
  <title>Tambah Rekam Medis</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="max-w-md mx-auto p-6">

  <h1 class="text-xl font-bold mb-4 text-center">âž• Tambah Rekam Medis</h1>

  <form id="form" class="space-y-4">
    <input name="id_pasien" placeholder="ID Pasien" required class="w-full border px-3 py-2 rounded" />
    <input name="tanggal_dibuat" type="date" required class="w-full border px-3 py-2 rounded" />
    <input name="golongan_darah" placeholder="Golongan Darah" class="w-full border px-3 py-2 rounded" />
    <input name="alergi" placeholder="Alergi" class="w-full border px-3 py-2 rounded" />
    <input name="riwayat_penyakit" placeholder="Riwayat Penyakit" class="w-full border px-3 py-2 rounded" />
    <textarea name="catatan_dokter" placeholder="Catatan Dokter" class="w-full border px-3 py-2 rounded"></textarea>
    <select name="status" class="w-full border px-3 py-2 rounded">
      <option value="Aktif">Aktif</option>
      <option value="Nonaktif">Nonaktif</option>
    </select>
    <button type="submit" class="w-full bg-green-600 text-white py-2 rounded">Simpan</button>
  </form>

  <p id="notif" class="mt-4 text-center text-sm text-green-700 hidden">Data berhasil ditambahkan!</p>

  <script>
    const graphqlUrl = 'http://localhost:8001/graphql'; // Ganti sesuai port kamu

    form.onsubmit = async (e) => {
      e.preventDefault();

      const formData = Object.fromEntries(new FormData(form));
      const variables = {
        input: {
          id_pasien: parseInt(formData.id_pasien),
          tanggal_dibuat: formData.tanggal_dibuat,
          golongan_darah: formData.golongan_darah,
          alergi: formData.alergi,
          riwayat_penyakit: formData.riwayat_penyakit,
          catatan_dokter: formData.catatan_dokter,
          status: formData.status
        }
      };

      const query = `
        mutation($input: RekamMedisInput!) {
          tambahRekamMedis(input: $input) {
            id
          }
        }
      `;

      const res = await fetch(graphqlUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ query, variables })
      });

      const result = await res.json();
      if (!res.ok || result.errors) {
        alert('Gagal menyimpan: ' + (result.errors?.[0]?.message || 'Unknown error'));
        return;
      }

      document.getElementById('notif').classList.remove('hidden');
      form.reset();
    };
  </script>
</body>
</html>
